%
require-mp-math

:fib-loop ^mswap mover m+  ,I-- I@ ^1 = ~-if ^fib-loop ~then ^;
:fib ~( n -- fib ) ~#0 ~[m,] ^m@ ~#1 ~[m,] ^m@  ,I>R I! ^fib-loop ,R>I ^;

~
" Examples: " prn
"   cf examples/fib-mpz.cf -e '1000 fib m. cr bye'" prn
"   time cf examples/fib-mpz.cf -e '10000000 fib m. cr bye' | tee fib-10000000.txt" prn

~(
$ cf examples/fib-mpz.cf -e "1000 fib m. cr bye"
43466557686937456435688527675040625802564660517371780402481729089536555417949051890403879840079255169295922593080322634775209689623239873322471161642996440906533187938298969649928516003704476137795166849228875

$ time cf examples/fib-mpz.cf -e "10000000 fib m. cr bye" | tee fib-10000000.txt

real    8m27.096s
user    8m25.889s
sys     0m0.098s

$ ls -lh fib-10000000.txt
2.0M   fib-10000000.txt

$ wc -c fib-10000000.txt
2 091 738 fib-10000000.txt

112983437822539976031706363774586637294483719048904088151357764324553473116793313752421977745824774548850332954152973798291761897527392854363791302932051108039360716094706763227615682842489700641973662068255559628685120016487852475714279902976343533146254374883257472801918680344260933761312207871809322495247383548964504769641155882443810352689210488586302828910832578052825109197320550131317543039524697452095152991528738788912305999632133722895614826993855354514213892314918164302740415815459330320725972484422994590179133554283623442602636527246154312012890097417314300592726773088121516046861806949394272896431280390373271841495974480169900223527471956091469947375021197725098061063481027586845300814804461951748270277935734157917877048417134443292102734454315666770780853587478885576158019791123629805117280
...
)

echo on
